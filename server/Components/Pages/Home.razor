@page "/"


<a-scene>

	<!-- A big box for the floor with a collider on it -->
	<a-box sq-collider color="darkgreen" scale="30 0.1 30"></a-box>

	<!-- A 3d model of a christmas tree! -->
	<a-entity position="-7 0 -4" scale=".02 .02 .02"
		gltf-model="https://cdn.glitch.global/537d3be1-3c9d-4443-b94c-e84d2ba3ced3/christmas_tree_polycraft.glb?v=1669127630594"></a-entity>

	<!-- Some ambiance! -->
	<a-sound position="10 1 0" autoplay="true" loop="true" volume="0.05"
		src="https://cdn.glitch.global/537d3be1-3c9d-4443-b94c-e84d2ba3ced3/christmas.mp3?v=1669127746032"></a-sound>

	<a-entity position="0 0 0">

		<!-- A big box for the horizontal empty section -->
		<a-box depth="0.1" width="8" position="0.5 1.5 -5" color="green"></a-box>

		<!-- Several smaller sections for blanking in between each door -->
		<a-box depth="0.1" width="1" position="-0.5 0.5 -5" color="green"></a-box>
		<a-box depth="0.1" width="1" position="1.5 0.5 -5" color="green"></a-box>
		<a-box depth="0.1" width="1" position="3.5 0.5 -5" color="green"></a-box>
		<a-box depth="0.1" width="1" position="-2.5 0.5 -5" color="green"></a-box>

		<!-- Door 1 honeypot! -->
		<a-entity position="-2 0 -5">
			<a-plane position="0.5 0.5 0"
				src="https://cdn.glitch.global/537d3be1-3c9d-4443-b94c-e84d2ba3ced3/honeypot-256x256-30663.png"></a-plane>
			<!-- animation uses startEvents to trigger it, this also sets autoplay to false -->
			<a-entity
				animation="property: rotation; from: 0 0 0; to: 0 -90 0; dur: 700; easing: easeInOutExpo; startEvents: startAnimation">
				<a-box sq-collider sq-interactable handle-click depth="0.1" position="0.5 0.5 0" color="red">
					<a-text value="1" position="0 0.1 0.11" align="center"></a-text>
				</a-box>
			</a-entity>
		</a-entity>

		<!-- Door 2 candy! -->
		<a-entity position="0 0 -5">
			<a-plane position="0.5 0.5 0"
				src="https://cdn.glitch.global/537d3be1-3c9d-4443-b94c-e84d2ba3ced3/candy-256x256-30693.png"></a-plane>
			<a-entity
				animation="property: rotation; from: 0 0 0; to: 0 -90 0;  dur: 700; easing: easeInOutExpo;startEvents: startAnimation ">
				<a-box sq-collider sq-interactable handle-click depth="0.1" position="0.5 0.5 0" color="red">
					<a-text value="2" position="0 0.1 0.11" align="center"></a-text>
				</a-box>
			</a-entity>
		</a-entity>

		<!-- Door 3 chicken! -->
		<a-entity position="2 0 -5">
			<a-plane position="0.5 0.5 0"
				src="https://cdn.glitch.global/537d3be1-3c9d-4443-b94c-e84d2ba3ced3/chicken-256x256-30650.png"></a-plane>
			<a-entity
				animation="property: rotation; from: 0 0 0; to: 0 -90 0;  dur: 700; easing: easeInOutExpo; startEvents: startAnimation">
				<a-box sq-collider sq-interactable handle-click depth="0.1" position="0.5 0.5 0" color="red">
					<a-text value="3" position="0 0.1 0.11" align="center"></a-text>
				</a-box>
			</a-entity>
		</a-entity>

	</a-entity>

	<!-- A mirror! -->
	<a-entity sq-mirror position="0 1 10" rotation="0 180 0" scale="4 4 4"></a-entity>

	<!-- A portal back to the previous space! -->
	<a-link id="portal" position="-10 0 8" rotation="0 45 0" title="Community Hub"
		href="https://sq-community-hub.glitch.me" image="https://logo.clearbit.com/sidequestvr.com"></a-link>

</a-scene>

@code {

	private bool direction = true;
	private double boxPosX = 0;

	protected override async Task OnInitializedAsync()
	{
		var t = new PeriodicTimer(TimeSpan.FromMicroseconds(1000000 / 30));

		while (await t.WaitForNextTickAsync())
		{
			if (2 < boxPosX) direction = false;
			else if (boxPosX < 0) direction = true;

			if (direction) boxPosX += 0.01;
			else boxPosX -= 0.01;

			StateHasChanged();
		}
	}
}
