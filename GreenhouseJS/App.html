@code
{
	private static App _app;
	
	private Dictionary<string, ComponentBase> entities;

	AModel cphysical;
	AModel cntnrfltng;
	AModel lily00;
	AModel lily01;

	public App()
	{
		_app = this;
		entities	= new();
		cphysical	= new("cphysical", "#cphysical", collisionType: CollisionType.ConvexRecursive);
		cntnrfltng	= new("cntnrfltng", "#cntnrfltng", collisionType: CollisionType.ConvexRecursive);
		lily00		= new("lily00", "#lily00", collisionType: CollisionType.ConvexRecursive);
		lily01		= new("lily01", "#lily01", collisionType: CollisionType.ConvexRecursive);
	}

	protected override async Task OnInitializedAsync()
	{
		Console.WriteLine("OnInitializedAsync");

		await base.OnInitializedAsync();
	}

	protected override async Task OnParametersSetAsync()
	{
		Console.WriteLine("OnParametersSetAsync");

		await base.OnParametersSetAsync();
	}

	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		Console.WriteLine($"OnAfterRenderAsync({firstRender})");

		if(firstRender)
		{
			entities.Add("cphysical", cphysical);
			entities.Add("cntnrfltng", cntnrfltng);
			entities.Add("lily00", lily00);
			entities.Add("lily01", lily01);
			StateHasChanged();
		}
	}

	private void OnModelLoadedCallback(string topic)
	{
		Console.WriteLine($"Loaded {topic}");
	}

	// JS to C#
	
	[JSInvokable]
	public static async Task OnTriggerEnter(string topic)
	{
		Console.WriteLine($"Collided with {topic}");
		if (topic == "respawnfloor")
		{
			await _app.MovePlayer(9, 0.25, -4); // back to spawn
		}
	}
	
	// C# to JS

	public async Task MovePlayer(double x, double y, double z)
	{
		Dictionary<string, double> xyz = new();
		xyz.Add("x",x);
		xyz.Add("y",y);
		xyz.Add("z",z);
		await JS.InvokeVoidAsync("movePlayer", xyz);
	}
}
